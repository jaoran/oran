<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title> Yes </title>
</head>
<body>
<div class="card">
    <h2>ðŸ”‘ AI Connection</h2>
    <input type="password" id="apiKey" placeholder="Paste Gemini API Key Here...">
    <p style="font-size: 0.7rem; color: #8b949e;">Your key is stored only in this browser's memory.</p>
</div>

<div class="card">
    <h2>ðŸ¤– AI Research Assistant</h2>
    <input type="text" id="aiQuery" placeholder="Ask about FedEx, Stocks, or Plants...">
    <button class="btn" onclick="askAI()">Run Research</button>
    <div id="aiResponse" style="margin-top: 15px; font-size: 0.9rem; line-height: 1.4; white-space: pre-wrap;"></div>
</div>

<script>
    async function askAI() {
        const key = document.getElementById('apiKey').value;
        const query = document.getElementById('aiQuery').value;
        const responseDisplay = document.getElementById('aiResponse');

        if (!key) {
            alert("Please paste your API key first!");
            return;
        }

        responseDisplay.innerHTML = "<em>Thinking...</em>";

        try {
            // Updated to v1beta for better compatibility with 2026 models
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${key}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{ parts: [{ text: query }] }]
                })
            });

            const data = await response.json();

            // 1. Check for API-level errors (like wrong key or quota)
            if (data.error) {
                responseDisplay.innerHTML = `<span style="color: #ff7b72;">API Error: ${data.error.message}</span>`;
                return;
            }

            // 2. Robust parsing for the new Gemini response structure
            const candidate = data.candidates && data.candidates[0];
            if (candidate && candidate.content && candidate.content.parts && candidate.content.parts[0].text) {
                let aiText = candidate.content.parts[0].text;

                // Clean up any markdown triple backticks if they exist
                aiText = aiText.replace(/```html|```json|```/g, '');

                responseDisplay.innerText = aiText;
            } else {
                // Debugging: If parsing fails, show the structure in the console
                console.error("Unrecognized JSON structure:", data);
                responseDisplay.innerHTML = `<span style="color: #ffa657;">Parsing Error. Check the browser console (F12) for the raw data.</span>`;
            }

        } catch (error) {
            responseDisplay.innerHTML = `<span style="color: #ff7b72;">Connection Error: ${error.message}</span>`;
        }
    }
</script>
</body>
</html>